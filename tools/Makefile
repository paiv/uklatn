.PHONY: all c csharp elixir go java js php py ruby rust swift

PYTHON ?= python
PROJECT_ROOT ?= ..
FORMAT ?= 1

all: c csharp elixir go java js php py ruby rust swift

c:
	@echo "/* Generated by gentables.py, do not edit. */\n" > "$(PROJECT_ROOT)/c/_tables.c"
	@$(PYTHON) gentables.py c >> "$(PROJECT_ROOT)/c/_tables.c"
	@echo "/* Generated by gentests.py, do not edit. */\n" > "$(PROJECT_ROOT)/c/_tests.c"
	@$(PYTHON) gentests.py c >> "$(PROJECT_ROOT)/c/_tests.c"

csharp:
	@echo "/* Generated by gentables.py, do not edit. */\n" > "$(PROJECT_ROOT)/csharp/UkrainianLatin/UkrainianLatin.cs"
	@$(PYTHON) gentables.py csharp >> "$(PROJECT_ROOT)/csharp/UkrainianLatin/UkrainianLatin.cs"
	@echo "/* Generated by gentests.py, do not edit. */\n" > "$(PROJECT_ROOT)/csharp/UkrainianLatin.Tests/UkrainianLatinTest.cs"
	@$(PYTHON) gentests.py csharp >> "$(PROJECT_ROOT)/csharp/UkrainianLatin.Tests/UkrainianLatinTest.cs"

elixir:
	@echo "# Generated by gentables.py, do not edit.\n" > "$(PROJECT_ROOT)/elixir/lib/paiv/ukrainian_latin.ex"
	@$(PYTHON) gentables.py elixir >> "$(PROJECT_ROOT)/elixir/lib/paiv/ukrainian_latin.ex"
	@echo "# Generated by gentests.py, do not edit.\n" > "$(PROJECT_ROOT)/elixir/test/paiv/ukrainian_latin_test.exs"
	@$(PYTHON) gentests.py elixir >> "$(PROJECT_ROOT)/elixir/test/paiv/ukrainian_latin_test.exs"
ifneq ($(FORMAT),0)
	@(cd $(PROJECT_ROOT)/elixir && mix format)
endif

go:
	@echo "/* Generated by gentables.py, do not edit. */\n" > "$(PROJECT_ROOT)/go/uklatn/uklatn.go"
	@$(PYTHON) gentables.py go >> "$(PROJECT_ROOT)/go/uklatn/uklatn.go"
	@echo "/* Generated by gentests.py, do not edit. */\n" > "$(PROJECT_ROOT)/go/uklatn/uklatn_test.go"
	@$(PYTHON) gentests.py go >> "$(PROJECT_ROOT)/go/uklatn/uklatn_test.go"
ifneq ($(FORMAT),0)
	@(cd $(PROJECT_ROOT)/go/uklatn && go fmt -x)
endif

java:
	@echo "/* Generated by gentables.py, do not edit. */\n" > "$(PROJECT_ROOT)/java/src/main/java/io/github/paiv/uklatn/UkrainianLatin.java"
	@$(PYTHON) gentables.py java >> "$(PROJECT_ROOT)/java/src/main/java/io/github/paiv/uklatn/UkrainianLatin.java"
	@echo "/* Generated by gentests.py, do not edit. */\n" > "$(PROJECT_ROOT)/java/src/test/java/io/github/paiv/uklatn/UkrainianLatinTest.java"
	@$(PYTHON) gentests.py java >> "$(PROJECT_ROOT)/java/src/test/java/io/github/paiv/uklatn/UkrainianLatinTest.java"

js:
	@echo "/* Generated by gentables.py, do not edit. */\n" > "$(PROJECT_ROOT)/js/uklatn.js"
	@$(PYTHON) gentables.py js >> "$(PROJECT_ROOT)/js/uklatn.js"
	@echo "/* Generated by gentests.py, do not edit. */\n" > "$(PROJECT_ROOT)/js/testuklatn.js"
	@$(PYTHON) gentests.py js >> "$(PROJECT_ROOT)/js/testuklatn.js"
	# tsc --declaration "$(PROJECT_ROOT)/js/uklatn.js" --allowJs --emitDeclarationOnly

php:
	@$(PYTHON) gentables.py php > "$(PROJECT_ROOT)/php/src/UkrainianLatin.php"
	@$(PYTHON) gentests.py php > "$(PROJECT_ROOT)/php/test/UkrainianLatinTest.php"

py:
	@echo "#!/usr/bin/env python\n# Generated by gentables.py, do not edit.\n" > "$(PROJECT_ROOT)/python/uklatn.py"
	@$(PYTHON) gentables.py py >> "$(PROJECT_ROOT)/python/uklatn.py"
	@echo "# Generated by gentests.py, do not edit.\n" > "$(PROJECT_ROOT)/python/tests/uklatn_tests.py"
	@$(PYTHON) gentests.py py >> "$(PROJECT_ROOT)/python/tests/uklatn_tests.py"

ruby:
	@echo "# Generated by gentables.py, do not edit.\n" > "$(PROJECT_ROOT)/ruby/lib/uklatn.rb"
	@$(PYTHON) gentables.py ruby >> "$(PROJECT_ROOT)/ruby/lib/uklatn.rb"
	@echo "# Generated by gentests.py, do not edit.\n" > "$(PROJECT_ROOT)/ruby/test/uklatn/test_uklatn.rb"
	@$(PYTHON) gentests.py ruby >> "$(PROJECT_ROOT)/ruby/test/uklatn/test_uklatn.rb"

rust:
	@echo "// Generated by gentables.py, do not edit.\n" > "$(PROJECT_ROOT)/rust/src/lib.rs"
	@$(PYTHON) gentables.py rust >> "$(PROJECT_ROOT)/rust/src/lib.rs"
	@echo "// Generated by gentests.py, do not edit.\n" > "$(PROJECT_ROOT)/rust/tests/uklatn_test.rs"
	@$(PYTHON) gentests.py rust >> "$(PROJECT_ROOT)/rust/tests/uklatn_test.rs"
ifneq ($(FORMAT),0)
	@(cd $(PROJECT_ROOT)/rust && cargo fmt)
endif

swift:
	@echo "/* Generated by gentables.py, do not edit. */\n" > "$(PROJECT_ROOT)/swift/Sources/UkrainianLatin/UKLatn.swift"
	@$(PYTHON) gentables.py swift >> "$(PROJECT_ROOT)/swift/Sources/UkrainianLatin/UKLatn.swift"
	@echo "/* Generated by gentests.py, do not edit. */\n" > "$(PROJECT_ROOT)/swift/Tests/UkrainianLatinTests/UKLatnTests.swift"
	@$(PYTHON) gentests.py swift >> "$(PROJECT_ROOT)/swift/Tests/UkrainianLatinTests/UKLatnTests.swift"
